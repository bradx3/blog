<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Dynamic Sites on Nginx With Passenger</title>
   <meta name="author" content="" />

   <!--- Blueprint CSS Framework -->
   <link rel="stylesheet" href="/css/blueprint/screen.css" type="text/css" media="screen, projection" />
   <link rel="stylesheet" href="/css/blueprint/print.css" type="text/css" media="print" />

   <!-- CodeRay syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/coderay.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/site.css" type="text/css" media="screen, projection" />
   <link rel="stylesheet" href="/css/style.css" type="text/css" />

   <!-- SyntaxHighlighter -->
   <script type="text/javascript" src="/scripts/shCore.js"></script>
   <script type="text/javascript" src="/scripts/shBrushBash.js"></script>
   <script type="text/javascript" src="/scripts/shBrushJScript.js"></script>
   <script type="text/javascript" src="/scripts/shBrushPlain.js"></script>
   <script type="text/javascript" src="/scripts/shBrushRuby.js"></script>
   <script type="text/javascript" src="/scripts/shBrushSql.js"></script>
   <script type="text/javascript" src="/scripts/shBrushXml.js"></script>
   <link type="text/css" rel="stylesheet" href="/styles/shCore.css"/>
   <link type="text/css" rel="stylesheet" href="/styles/shThemeDefault.css"/>
   <script type="text/javascript">
     SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
     SyntaxHighlighter.all();
   </script>
</head>
<body>

<div class="container">

   <div class="column span-20 prepend-2 append-2 first last" id="header">
     <a href="/">
       <img src="/images/banner.gif" alt="Lucky-Dip Blog"/>
     </a>
   </div>

   <div class="column span-15 prepend-2 first content">
      <div class="article">
    <h1>
      <a href="/articles/2013/05/04/dynamic-sites-on-nginx-with-passenger/">Dynamic Sites on Nginx With Passenger</a>
      <span class="date">
	(2013-05-04)
      </span>
    </h1>
     <div class="body">
       <p>
  If you are using passenger with nginx, it's possible to set nginx up in a way that
  allows new apps (or branches of the same app) to be deployed with no change to the
  server config.
</p>
<p>
  <h3>Step 1</h3>
  Add this config to your nginx.conf. Edit the hostname to match your server, and
  the root to match your deploy directory
  <pre>server {
   server_name ~^([-\w]+)\.yourdomain.com;
   root /var/www/$1/current/public;
   passenger_enabled on;
}</pre>
</p>
<p>
  <h3>Step 2</h3>
  Deploy your rails app to /var/www/whatever/current. The app will then be available
  at http://whatever.yourdomain.com.
  <br/><br/>
  Similarly, deploying to /var/www/some-internal-app/current means the app will be available at
  http://some-internal-app.yourdomain.com
</p>
<p>
  <h3>Notes</h3>
  This technique probably isn't ideal for production sites, but for internal and or
  temporary sites it is quite useful. Passenger takes care of spinning up apps as they
  are requested, so if one app is getting lots of requests, passenger will naturally
  spin up more app servers for that one, potentially spinning down unused apps. Providing
  all apps aren't being constantly accessed, this acts as a kind of resource balancing
  allowing an underpowered internal server to serve a lot of apps.
</p>

     </div>
     <div><div id="disqus_thread"></div>
<script type="text/javascript" src="http://disqus.com/forums/lucky-dipblog/embed.js"></script><noscript><a href="http://lucky-dipblog.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></div>
 
</div>

   </div>

   <div class="column span-5 append-2 last sidebar">
     <h4>About</h4>
     <div>
       <img src="/images/brad_head.gif" />
       <p>My name is Brad. I am a programmer from Sydney, Australia. I like lots of coding stuff, but especially ruby and iPhone.
       </p>
       <p>I am available for contracting work. Contact me at brad at lucky-dip.net</p>
     </div>

     <h4>What I'm...</h4>
     <div>
       <ul>
       <li><a href="http://github.com/bradx3">Working on</a></li>
       <li><a href="http://twitter.com/bradx3">Thinking</a></li>
       </ul>
     </div>

     <h4>Syndicate</h4>
     <div>
       <a href="/feed.xml">RSS</a>
     </div>

   </div>

   <div class="column span-20 prepend-2 append-2 first last" id="footer">
     <hr />
     <p>This website was created with <a href="http://webby.rubyforge.org">Webby</a></p>
   </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19254782-1']);
  _gaq.push(['_setDomainName', '.lucky-dip.net']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
